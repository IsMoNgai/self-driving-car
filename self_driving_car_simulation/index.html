<!DOCTYPE html>
<head>
    <title>self driving car no library</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="carCanvas"></canvas>
    <div id="verticalButtons">
        <button onclick="save()">üíæ</button>
        <button onclick="discard()">üóëÔ∏è</button>
        <label for="fileInput" class="file-input-label">
            üìÅ
            <input 
                type="file"
                id="fileInput"
                accept=".world"
                onchange="load(event)"
            />
        </label>
    </div>
    <div>
        <canvas id="networkCanvas"></canvas>
        <canvas id="miniMapCanvas"></canvas>       
    </div>
    <script>
        function load(event) {
            const file = event.target.files[0];

            if (!file) {
                alert("No file selected.");
                return;
            }

            const reader = new FileReader();
            reader.readAsText(file);

            reader.onload = (evt) => {
                const fileContent = evt.target.result;
                const jsonData = JSON.parse(fileContent);
                world = World.load(jsonData);

                try {
                    localStorage.setItem("world", JSON.stringify(world));
                    location.reload();
                } catch (e) {
                    if (e.name === 'QuotaExceededError') {
                        loadBigMap(world); // Call the function to handle large maps
                    } else {
                        console.error("An error occurred while saving 'world':", e);
                    }
                }
            };
        }

        function loadBigMap(world) {
            // handle big folder by saving a file copy to the user download directory
            // and read the file from there
            const element = document.createElement("a");
            element.setAttribute(
                "href",
                "data:application/json;charset=utf-8," +
                    encodeURIComponent(JSON.stringify(world))
            );
            element.setAttribute("download", "large_world.json");

            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }


    </script>
    <script src="world/js/world.js"></script>
    <script src="world/js/viewport.js"></script>
    <script src="world/js/markings/marking.js"></script>
    <script src="world/js/markings/stop.js"></script>
    <script src="world/js/markings/crossing.js"></script>
    <script src="world/js/markings/start.js"></script>
    <script src="world/js/editors/markingEditor.js"></script>
    <script src="world/js/editors/graphEditor.js"></script>
    <script src="world/js/editors/stopEditor.js"></script>
    <script src="world/js/editors/crossingEditor.js"></script>
    <script src="world/js/editors/startEditor.js"></script>
    <script src="world/js/items/tree.js"></script>
    <script src="world/js/items/building.js"></script>
    <script src="world/js/math/utils.js"></script>
    <script src="world/js/math/graph.js"></script>
    <script src="world/js/primitives/point.js"></script>
    <script src="world/js/primitives/segment.js"></script>
    <script src="world/js/primitives/polygon.js"></script>
    <script src="world/js/primitives/envelope.js"></script>
    
    <script src="world/saves/big.world"></script>
    
    <script src="miniMap.js"></script>
    <script src="visualizer.js"></script>
    <script src="network.js"></script>
    <script src="sensor.js"></script>
    <script src="utils.js"></script>
    <script src="controls.js"></script>
    <script src="car.js"></script>
    <script src="main.js"></script>
</body>